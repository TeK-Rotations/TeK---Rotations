version: 1
author: TeK
class: shaman
spec: 262
name: TeK GOAT Elemental
description: Elemental Shaman 12.0 | Mouseover Interrupt System
entry: main

movement_allowed: buff.spiritwalkers_grace.up

morphs:
  lava_burst: lava_burst

config:
  astral_shift_hp:
    label: "Astral Shift HP %"
    type: slider
    min: 10
    max: 60
    default: 35
  interrupt_timing_min:
    label: "Interrupt Delay Min (ms)"
    type: slider
    min: 0
    max: 500
    default: 100
  interrupt_timing_max:
    label: "Interrupt Delay Max (ms)"
    type: slider
    min: 100
    max: 1000
    default: 400
  use_spiritwalkers_grace:
    label: "Use Spiritwalker's"
    type: checkbox
    default: true
  use_ghost_wolf:
    label: "Use Wolf in Combat"
    type: checkbox
    default: true
  ghost_wolf_delay:
    label: "Wolf Delay (seconds)"
    type: slider
    min: 0
    max: 5
    default: 2

  # === TEK INTERRUPT CONFIG ===
  use_cap_totem_interrupt:
    label: "Mouseover CapTotem Interrupts"
    type: checkbox
    default: true
    description: "Use Capacitor Totem to stun-interrupt priority casts"
  use_thunderstorm_interrupt:
    label: "Mouseover Thunderstorm Interrupts"
    type: checkbox
    default: false
    description: "Use Thunderstorm knockback to interrupt priority casts (displaces mobs)"

variables:
  mael_cap: (100+50*talent.swelling_maelstrom+25*talent.primordial_capacity)
  health_critical: (health.pct<20)
  aoe_mode: (active_enemies>=2)
  can_cast_moving: (buff.spiritwalkers_grace.up)
  st_spend: (maelstrom>var.mael_cap-15|buff.master_of_the_elements.up)
  aoe_spend: (maelstrom>var.mael_cap-10*(active_enemies+1)|buff.master_of_the_elements.up|buff.ascendance.up&buff.ascendance.remains<3|fight_remains<5)
  lr_spread: (talent.lightning_rod&nameplates.debuff.lightning_rod.count<active_enemies&(buff.stormkeeper.up|buff.tempest.up))
  prefer_eq: (!talent.elemental_blast|active_enemies>1+3*talent.tempest)
  st_lvb_condition: (!buff.master_of_the_elements.up&(buff.lava_surge.up|buff.tempest.up|buff.stormkeeper.up|cooldown.lava_burst.charges_fractional>1.8|maelstrom>var.mael_cap-30|maelstrom>52-5*talent.eye_of_the_storm*(1+talent.elemental_blast)+30*talent.elemental_blast))

  # === TEK INTERRUPT SYSTEM ===
  kick_ready: (cooldown.wind_shear.ready)
  interrupt_delay_min: (config.interrupt_timing_min/1000)
  interrupt_delay_max: (config.interrupt_timing_max/1000)
  safe_interrupt_window: (target.casting.elapsed>=var.interrupt_delay_min&target.casting.elapsed<=var.interrupt_delay_max)
  safe_interrupt_window_late: (target.casting.elapsed>=var.interrupt_delay_max&target.casting.remains>0.3)
  safe_interrupt_window_mo: (mouseover.casting.elapsed>=var.interrupt_delay_min&mouseover.casting.elapsed<=var.interrupt_delay_max)
  safe_interrupt_window_mo_late: (mouseover.casting.elapsed>=var.interrupt_delay_max&mouseover.casting.remains>0.3)
  cap_totem_ready: (talent.capacitor_totem&cooldown.capacitor_totem.ready&config.use_cap_totem_interrupt)
  thunderstorm_ready: (cooldown.thunderstorm.ready&config.use_thunderstorm_interrupt)
  thunderstorm_should_fire: (var.thunderstorm_ready&!var.kick_ready&(!config.use_cap_totem_interrupt|!var.cap_totem_ready))

lists:
  main:
    - return,if=!state.rotation|player.mounted

    # === GHOST WOLF (out of combat, skipped during Spiritwalker's Grace) ===
    - ghost_wolf,range_check=none,if=config.use_ghost_wolf&!player.combat&player.moving&!buff.ghost_wolf.up&!var.can_cast_moving
    - return,if=config.use_ghost_wolf&!player.combat&player.moving&buff.ghost_wolf.up&!var.can_cast_moving

    # === WEAPON/SHIELD BUFFS ===
    - flametongue_weapon,range_check=none,if=!mainhand.enchant.up&!player.mounted&!buff.ghost_wolf.up
    - lightning_shield,range_check=none,if=buff.lightning_shield.down&!player.mounted&!buff.ghost_wolf.up
    - thunderstrike_ward,range_check=none,if=buff.thunderstrike_ward.down&!player.mounted&!buff.ghost_wolf.up

    # === PRECOMBAT STORMKEEPER ===
    - stormkeeper,if=!player.combat&target.exists&target.enemy&target.alive&cooldown.stormkeeper.ready&!buff.stormkeeper.up&enemies.inrange(40)>=1

    # === AUTO-TARGET ===
    - target_enemy,if=player.combat&(!target.exists|target.range>40|target.dead)&enemies.combat.40y>=1

    - return,if=!player.combat
    - return,if=!target.exists|target.dead|!target.enemy

    # === TEK INTERRUPTS ===
    - call_action_list,name=interrupts,if=player.combat

    # === DEFENSIVES ===
    - call_action_list,name=defensives

    # === COOLDOWNS ===
    - ascendance,range_check=none,if=cooldown.ascendance.ready&cooldown.stormkeeper.remains>10
    - natures_swiftness,range_check=none,if=cooldown.natures_swiftness.ready
    - spiritwalkers_grace,range_check=none,if=config.use_spiritwalkers_grace&player.moving&target.range>6

    # === GHOST WOLF (in combat, skipped during Spiritwalker's Grace) ===
    - call_action_list,name=movement,if=config.use_ghost_wolf&player.moving&!var.can_cast_moving&!buff.ascendance.up&player.moving.time>=config.ghost_wolf_delay&player.combat

    # === CORE ROTATION ===
    - run_action_list,name=aoe,if=var.aoe_mode
    - run_action_list,name=single_target,if=!var.aoe_mode

  movement:
    - ghost_wolf,range_check=none,if=!buff.ghost_wolf.up&!var.can_cast_moving
    - return,if=buff.ghost_wolf.up

  defensives:
    - astral_shift,range_check=none,if=health.pct<config.astral_shift_hp&cooldown.astral_shift.ready
    - healthstone,if=healthstone.ready&var.health_critical
    - health_potion,if=health_potion.ready&var.health_critical&!healthstone.ready

  interrupts:
    # ====================================================================
    # TEK MOUSEOVER INTERRUPT SYSTEM
    # No auto-tab. Hover the caster's nameplate to interrupt.
    # Priority: Wind Shear → Cap Totem → Thunderstorm
    # ====================================================================

    # === CURRENT TARGET — Wind Shear (30yd) ===
    - wind_shear,if=interrupts.target.ready&var.kick_ready&var.safe_interrupt_window&!target.boss
    - wind_shear,if=interrupts.target.ready&var.kick_ready&var.safe_interrupt_window_late&!target.boss

    # === MOUSEOVER — Wind Shear (30yd, no target swap) ===
    - wind_shear.mouseover,if=interrupts.mouseover.ready&var.kick_ready&var.safe_interrupt_window_mo&!mouseover.boss
    - wind_shear.mouseover,if=interrupts.mouseover.ready&var.kick_ready&var.safe_interrupt_window_mo_late&!mouseover.boss

    # === CURRENT TARGET — Cap Totem (stun when kick on CD) ===
    - capacitor_totem.cursor,if=(interrupts.target.ready|interrupts.target.stun.ready)&var.cap_totem_ready&!var.kick_ready&target.range<=8&target.casting.elapsed>=0.1&!target.boss

    # === MOUSEOVER — Cap Totem (AoE stun on mouseover position) ===
    - capacitor_totem.mouseover,if=(interrupts.mouseover.ready|interrupts.mouseover.stun.ready)&var.cap_totem_ready&!var.kick_ready&mouseover.range<=40&mouseover.casting.elapsed>=0.1&!mouseover.boss

    # === CURRENT TARGET — Thunderstorm (knockback full interrupt) ===
    - thunderstorm,if=interrupts.target.ready&var.thunderstorm_should_fire&target.range<=10&target.casting.elapsed>=0.1&!target.boss
    - thunderstorm,if=interrupts.target.stun.ready&var.thunderstorm_should_fire&target.range<=10&target.casting.elapsed>=0.1&!target.boss

  aoe:
    - stormkeeper,range_check=none,if=cooldown.stormkeeper.ready
    - ancestral_swiftness,range_check=none,if=cooldown.ancestral_swiftness.ready
    - flame_shock,if=nameplates.debuff.flame_shock.count=0&active_enemies<=3&cooldown.ascendance.remains>10
    - voltaic_blaze,if=(nameplates.debuff.flame_shock.count=0|talent.purging_flames)
    - blood_fury,range_check=none,if=(!talent.ascendance|buff.ascendance.up|cooldown.ascendance.remains>50)
    - berserking,range_check=none,if=(!talent.ascendance|buff.ascendance.up)
    - fireblood,range_check=none,if=(!talent.ascendance|buff.ascendance.up|cooldown.ascendance.remains>50)
    - ancestral_call,range_check=none,if=(!talent.ascendance|buff.ascendance.up|cooldown.ascendance.remains>50)
    - trinket_1,if=trinket_1.has_stat&trinket_1.ready&(cooldown.ascendance.remains>trinket_1.cd|buff.ascendance.remains>12|fight_remains<21)
    - trinket_2,if=trinket_2.has_stat&trinket_2.ready&(cooldown.ascendance.remains>trinket_2.cd|buff.ascendance.remains>12|fight_remains<21)
    - weapon_onuse,if=weapon.ready&(cooldown.ascendance.remains>15|buff.ascendance.remains>12)
    - trinket_1,if=!trinket_1.has_stat&trinket_1.ready&(cooldown.ascendance.remains>20|trinket_2.cd>20)
    - trinket_2,if=!trinket_2.has_stat&trinket_2.ready&(cooldown.ascendance.remains>20|trinket_1.cd>20)
    - combat_potion,if=combat_potion.ready&(buff.bloodlust.up|buff.ascendance.remains>12|fight_remains<31)
    - tempest,if=buff.tempest.stack=2
    - earthquake.cursor,if=var.aoe_spend&var.prefer_eq
    - elemental_blast,if=var.aoe_spend
    - earth_shock,if=var.aoe_spend
    - earthquake.cursor,if=var.lr_spread&var.prefer_eq
    - elemental_blast,if=var.lr_spread
    - earth_shock,if=var.lr_spread
    - lava_burst,if=debuff.flame_shock.remains>0&cooldown.lava_burst.ready&buff.lava_surge.up&!buff.master_of_the_elements.up&talent.master_of_the_elements&active_enemies<=3
    - lava_burst,if=debuff.flame_shock.remains>2&!buff.master_of_the_elements.up&talent.master_of_the_elements&(buff.stormkeeper.up|buff.tempest.up|maelstrom>82-10*talent.eye_of_the_storm|maelstrom>52-5*talent.eye_of_the_storm&!talent.elemental_blast)&active_enemies<=3&!talent.lightning_rod&talent.call_of_the_ancestors
    - lava_burst,if=debuff.flame_shock.remains>2&!buff.master_of_the_elements.up&active_enemies=2
    - lava_burst,if=debuff.flame_shock.remains>2&buff.purging_flames.up&(buff.ascendance.up&buff.ascendance.remains<3|buff.lava_surge.up)
    - lightning_bolt,if=buff.stormkeeper.up&!buff.call_of_the_ancestors.up&active_enemies=2
    - chain_lightning,if=target.valid
    - flame_shock,if=player.moving&debuff.flame_shock.refreshable
    - voltaic_blaze,if=player.moving&debuff.flame_shock.refreshable
    - frost_shock,if=player.moving

  single_target:
    - stormkeeper,range_check=none,if=cooldown.stormkeeper.ready
    - ancestral_swiftness,range_check=none,if=cooldown.ancestral_swiftness.ready
    - flame_shock,if=nameplates.debuff.flame_shock.count=0&!buff.master_of_the_elements.up
    - voltaic_blaze,if=nameplates.debuff.flame_shock.count=0
    - blood_fury,range_check=none,if=(!talent.ascendance|buff.ascendance.up|cooldown.ascendance.remains>50)
    - berserking,range_check=none,if=(!talent.ascendance|buff.ascendance.up)
    - fireblood,range_check=none,if=(!talent.ascendance|buff.ascendance.up|cooldown.ascendance.remains>50)
    - ancestral_call,range_check=none,if=(!talent.ascendance|buff.ascendance.up|cooldown.ascendance.remains>50)
    - trinket_1,if=trinket_1.has_stat&trinket_1.ready&(cooldown.ascendance.remains>trinket_1.cd|buff.ascendance.remains>12|fight_remains<21)
    - trinket_2,if=trinket_2.has_stat&trinket_2.ready&(cooldown.ascendance.remains>trinket_2.cd|buff.ascendance.remains>12|fight_remains<21)
    - weapon_onuse,if=weapon.ready&(cooldown.ascendance.remains>15|buff.ascendance.remains>12)
    - trinket_1,if=!trinket_1.has_stat&trinket_1.ready&(cooldown.ascendance.remains>20|trinket_2.cd>20)
    - trinket_2,if=!trinket_2.has_stat&trinket_2.ready&(cooldown.ascendance.remains>20|trinket_1.cd>20)
    - combat_potion,if=combat_potion.ready&(buff.bloodlust.up|buff.ascendance.remains>12|fight_remains<31)
    - elemental_blast,if=var.st_spend
    - earth_shock,if=var.st_spend
    - lava_burst,if=debuff.flame_shock.remains>=2&var.st_lvb_condition
    - tempest,if=buff.tempest.stack>=1
    - lightning_bolt,if=target.valid
    - flame_shock,if=player.moving&debuff.flame_shock.refreshable
    - voltaic_blaze,if=player.moving&debuff.flame_shock.refreshable
    - flame_shock,if=player.moving&target.range>6
    - voltaic_blaze,if=player.moving&target.range>6
    - frost_shock,if=player.moving