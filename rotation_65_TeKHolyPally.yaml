version: 1.5
author: TeK
spec: 65
name: TeK's HOLYSHITadin
description: |
  Holy Paladin healing and DPS rotation. Herald of the Sun and Lightsmith builds.
  Auto-detects ST vs AOE healing. Spell-queued execution with stall-free design.

entry: main

movement_allowed: true

morphs:
  avenging_wrath: avenging_crusader
  divine_toll: holy_armaments

config:

  emergency_hp:
    label: "Emergency HP %"
    type: slider
    min: 10
    max: 40
    default: 25

  tank_heal_hp:
    label: "Tank Heal HP %"
    type: slider
    min: 40
    max: 90
    default: 70

  member_heal_hp:
    label: "Member Heal HP %"
    type: slider
    min: 50
    max: 95
    default: 80

  wog_heal_hp:
    label: "Word of Glory HP %"
    type: slider
    min: 50
    max: 95
    default: 80

  shock_heal_hp:
    label: "Holy Shock Heal HP %"
    type: slider
    min: 55
    max: 95
    default: 85

  fol_heal_hp:
    label: "Flash of Light HP %"
    type: slider
    min: 25
    max: 80
    default: 45

  defensive_hp:
    label: "Defensive CD HP %"
    type: slider
    min: 30
    max: 80
    default: 60

  lod_min_targets:
    label: "Light of Dawn Min Injured"
    type: slider
    min: 2
    max: 5
    default: 3

  aw_trigger_count:
    label: "Avenging Wrath Injured Count"
    type: slider
    min: 1
    max: 5
    default: 2

  bov_trigger_count:
    label: "Beacon of Virtue Injured Count"
    type: slider
    min: 2
    max: 5
    default: 3

  hero_talent_build:
    label: "Hero Talent Build"
    type: dropdown
    options:
      - label: "Herald of the Sun"
        value: 1
      - label: "Lightsmith"
        value: 2
      - label: "Auto-detect"
        value: 0
    default: 0

  auto_interrupt:
    label: "Auto Interrupt"
    type: checkbox
    default: true

  auto_target_interrupts:
    label: "Auto Target Interrupts"
    type: checkbox
    default: true

  interrupt_timing_min:
    label: "Interrupt Delay Min (ms)"
    type: slider
    min: 0
    max: 500
    default: 100

  interrupt_timing_max:
    label: "Interrupt Delay Max (ms)"
    type: slider
    min: 100
    max: 1000
    default: 400

  auto_dispel:
    label: "Auto Dispel"
    type: checkbox
    default: true

  auto_resurrect:
    label: "Auto Resurrect (OOC)"
    type: checkbox
    default: true

  mouseover:
    label: "Enable Mouseover Healing"
    type: checkbox
    default: true

  auto_blessing_of_freedom:
    label: "Auto Blessing of Freedom"
    type: checkbox
    default: true

  trinket_usage:
    label: "Trinket Usage"
    type: dropdown
    options:
      - label: "On Cooldown"
        value: 1
      - label: "With Major Cooldowns"
        value: 2
      - label: "When group damaged"
        value: 3
      - label: "Manual Only"
        value: 0
    default: 1

variables:

  herald_build: config.hero_talent_build=1|talent.dawnlight.enabled
  lightsmith_build: config.hero_talent_build=2|talent.holy_armaments.enabled

  needs_emergency: group.lowest.health.pct<config.emergency_hp
  needs_tank_healing: group.tanks.lowest.health.pct<config.tank_heal_hp
  needs_member_healing: group.lowest.health.pct<config.member_heal_hp
  group_needs_healing: group.count(cycle.health.pct<85)>=2
  tank_emergency: group.tanks.lowest.health.pct<config.emergency_hp
  group_heavy_damage: group.count(cycle.health.pct<config.member_heal_hp)>=3
  aoe_defensive_needed: group.count(cycle.health.pct<config.emergency_hp)>=3
  player_critical_health: health.pct<20
  player_low_health: health.pct<config.emergency_hp
  player_needs_healing: health.pct<config.member_heal_hp
  player_needs_defensive: health.pct<config.defensive_hp

  hp_capped: holy_power>=5
  hp_near_cap: holy_power>=4
  hp_can_spend: holy_power>=3|buff.divine_purpose.up
  hp_deficit_ok: holy_power<5
  hp_pool_for_toll: "!var.needs_emergency&cooldown.divine_toll.remains>0&cooldown.divine_toll.remains<3&holy_power>=2"

  holy_shock_ready: cooldown.holy_shock.ready
  judgment_ready: cooldown.judgment.ready
  divine_toll_ready: cooldown.divine_toll.ready
  aw_ready: cooldown.avenging_wrath.ready
  aura_mastery_ready: cooldown.aura_mastery.ready
  lay_on_hands_ready: cooldown.lay_on_hands.ready
  divine_protection_ready: cooldown.divine_protection.ready

  ac_active: buff.avenging_crusader.up
  wings_or_ac: buff.avenging_wrath.up|buff.avenging_crusader.up
  bov_active: buff.beacon_of_virtue.up

  infusion_up: buff.infusion_of_light.up
  empyrean_legacy_up: buff.empyrean_legacy.up
  divine_purpose_up: buff.divine_purpose.up
  sun_sear_up: buff.sun_sear.up
  suns_avatar_up: buff.suns_avatar.up
  tyrs_up: buff.tyrs_deliverance.up
  divine_favor_up: buff.divine_favor.up

  hoj_ready: cooldown.hammer_of_justice.ready
  interrupt_delay_min: config.interrupt_timing_min/1000
  interrupt_delay_max: config.interrupt_timing_max/1000
  safe_interrupt_window: target.casting.elapsed>=var.interrupt_delay_min&target.casting.elapsed<=var.interrupt_delay_max
  safe_interrupt_window_late: target.casting.elapsed>=var.interrupt_delay_max&target.casting.remains>0.3

  need_preheal: target.casting&target.casting_target.health.pct<config.member_heal_hp

  mo_friendly_valid: mouseover.exists&mouseover.alive&mouseover.friendly&mouseover.range>0&mouseover.range<=40
  main_mouseover_healing: config.mouseover&var.mo_friendly_valid&!player.casting&!player.channeling

  racial_defensive_hp: 50
  racial_emergency_hp: 35

lists:

  spell_queue:
    - queue_spell

  sanity_checks:
    - return,if=player.dead
    - return,if=mounted
    - return,if=!state.rotation
    - return,if=state.blocked_inputs
    - return,if=player.loot_nearby

  pre_pull_setup:
    - beacon_of_light,cycle=tanks,if=!talent.beacon_of_virtue.enabled&group.count(cycle.buff.beacon_of_light.up)=0&cycle.range>0&cycle.range<=40
    - beacon_of_faith,cycle=dps,if=talent.beacon_of_faith.enabled&group.count(cycle.buff.beacon_of_faith.up)=0&cycle.range>0&cycle.range<=40

  out_of_combat:
    - devotion_aura,if=buff.devotion_aura.down
    - beacon_of_light,cycle=tanks,if=!talent.beacon_of_virtue.enabled&group.count(cycle.buff.beacon_of_light.up)=0&cycle.range>0&cycle.range<=40
    - beacon_of_faith,cycle=dps,if=talent.beacon_of_faith.enabled&group.count(cycle.buff.beacon_of_faith.up)=0&cycle.range>0&cycle.range<=40
    - redemption,cycle=dead,if=config.auto_resurrect&cycle.range>0&cycle.range<=40
    - eternal_flame,cycle=members,if=var.hp_can_spend&cycle.health.pct<70
    - word_of_glory,cycle=members,if=var.hp_can_spend&cycle.health.pct<70
    - holy_shock,cycle=members,if=cycle.health.pct<config.member_heal_hp&var.holy_shock_ready&cycle.range>0&cycle.range<=40
    - holy_shock.player,if=var.holy_shock_ready&var.player_needs_healing
    - flash_of_light,cycle=members,if=cycle.health.pct<config.member_heal_hp&cycle.range>0&cycle.range<=40
    - flash_of_light.player,if=var.player_needs_healing

  auto_target:
    - target_enemy,if=player.combat&(!target.exists|target.dead|target.friendly)&active_enemies>0
    - target_enemy,if=player.combat&!target.valid&active_enemies>0
    - target_enemy,if=player.combat&(!target.exists|target.range>8|target.dead)&enemies.inrange(8)>=1

  interrupts:
    - target_enemy,if=config.auto_interrupt&config.auto_target_interrupts&(interrupts.10y.count>=1|interrupts.10y.stun.count>=1)&!interrupts.target.stun.ready&!target.casting.interruptible&(var.hoj_ready|cooldown.blinding_light.ready)&enemies.inrange(10)>=1
    - hammer_of_justice,if=config.auto_interrupt&interrupts.target.stun.ready&var.hoj_ready&var.safe_interrupt_window&!target.boss&!prev_gcd.1.hammer_of_justice
    - hammer_of_justice,if=config.auto_interrupt&target.casting.interruptible&var.hoj_ready&var.safe_interrupt_window&!target.boss&!prev_gcd.1.hammer_of_justice
    - hammer_of_justice,if=config.auto_interrupt&(interrupts.target.stun.ready|target.casting.interruptible)&var.hoj_ready&var.safe_interrupt_window_late&!target.boss&!prev_gcd.1.hammer_of_justice
    - blinding_light,if=config.auto_interrupt&talent.blinding_light.enabled&(interrupts.10y.count>=2|interrupts.10y.stun.count>=2)&!prev_gcd.1.blinding_light
    - blinding_light,if=config.auto_interrupt&talent.blinding_light.enabled&(interrupts.target.stun.ready|target.casting.interruptible)&!var.hoj_ready&target.casting.elapsed>=0.1&!target.boss&!prev_gcd.1.blinding_light
    - hammer_of_justice.mouseover,if=config.auto_interrupt&(interrupts.mouseover.stun.ready|mouseover.casting.interruptible)&var.hoj_ready&mouseover.casting.elapsed>=var.interrupt_delay_min&!mouseover.boss&!prev_gcd.1.hammer_of_justice
    - hammer_of_justice.focus,if=config.auto_interrupt&(interrupts.focus.stun.ready|focus.casting.interruptible)&var.hoj_ready&focus.casting.elapsed>=var.interrupt_delay_min&!focus.boss&!prev_gcd.1.hammer_of_justice

  dispel:
    - cleanse,cycle=members,if=cycle.dispelable.list
    - blessing_of_freedom,if=config.auto_blessing_of_freedom&(player.rooted|player.debuff.snare.up)
    - blessing_of_freedom,cycle=members,if=config.auto_blessing_of_freedom&(cycle.debuff.snare.up|cycle.debuff.root.up)

  emergency_healing:
    - lay_on_hands,cycle=members,interrupt=true,if=var.lay_on_hands_ready&cycle.health.pct<15&cycle.range>0&cycle.range<=40&!cycle.debuff.forbearance.up
    - lay_on_hands.player,interrupt=true,if=var.lay_on_hands_ready&health.pct<15&!debuff.forbearance.up
    - divine_shield.player,interrupt=true,if=var.player_critical_health&cooldown.divine_shield.ready&buff.divine_shield.down
    - divine_protection.player,interrupt=true,if=player.combat&var.divine_protection_ready&var.player_low_health
    - blessing_of_protection,cycle=members,interrupt=true,if=cycle.health.pct<config.emergency_hp&cooldown.blessing_of_protection.ready&cycle.range>0&cycle.range<=40&!cycle.debuff.forbearance.up
    - blessing_of_protection.player,interrupt=true,if=player.combat&var.player_low_health&cooldown.blessing_of_protection.ready
    - blessing_of_sacrifice,cycle=tanks,if=var.tank_emergency&cooldown.blessing_of_sacrifice.ready&health.pct>40
    - eternal_flame,cycle=members,if=var.hp_can_spend&cycle.health.pct<config.emergency_hp
    - eternal_flame.player,if=var.hp_can_spend&var.player_low_health
    - word_of_glory,cycle=members,if=var.hp_can_spend&cycle.health.pct<config.emergency_hp
    - word_of_glory.player,if=var.hp_can_spend&var.player_low_health
    - holy_shock,cycle=members,if=var.holy_shock_ready&cycle.health.pct<config.emergency_hp
    - holy_shock.player,if=var.holy_shock_ready&var.player_low_health
    - flash_of_light,cycle=members,interrupt=true,if=var.infusion_up&cycle.health.pct<config.emergency_hp
    - flash_of_light.player,interrupt=true,if=var.infusion_up&var.player_low_health
    - flash_of_light,cycle=members,if=cycle.health.pct<config.emergency_hp
    - flash_of_light.player,if=var.player_low_health

  defensive_cooldowns:
    - lay_on_hands.player,interrupt=true,if=var.lay_on_hands_ready&var.player_low_health&!debuff.forbearance.up
    - divine_shield.player,interrupt=true,if=var.player_critical_health&cooldown.divine_shield.ready&buff.divine_shield.down
    - blessing_of_protection.player,interrupt=true,if=var.player_low_health&cooldown.blessing_of_protection.ready&!debuff.forbearance.up
    - blessing_of_protection,cycle=members,if=cooldown.blessing_of_protection.ready&cycle.health.pct<config.emergency_hp&cycle.range>0&cycle.range<=40&!cycle.debuff.forbearance.up
    - blessing_of_sacrifice,cycle=tanks,if=cooldown.blessing_of_sacrifice.ready&group.tanks.lowest.health.pct<config.tank_heal_hp&health.pct>40
    - lay_on_hands,cycle=members,if=var.lay_on_hands_ready&cycle.health.pct<15&cycle.range>0&cycle.range<=40&!cycle.debuff.forbearance.up
    - aura_mastery,if=var.aura_mastery_ready&var.aoe_defensive_needed

  major_cooldowns:
    - avenging_wrath,if=player.combat&var.aw_ready&var.needs_emergency
    - avenging_wrath,if=player.combat&var.aw_ready&group.count(cycle.health.pct<70)>=config.aw_trigger_count
    - avenging_wrath,if=player.combat&var.aw_ready&state.cds
    - divine_toll,if=player.combat&var.divine_toll_ready&var.needs_emergency
    - divine_toll,if=player.combat&var.divine_toll_ready&var.needs_member_healing&holy_power<=2
    - divine_toll,if=player.combat&var.divine_toll_ready&var.hp_deficit_ok&holy_power<=2
    - beacon_of_virtue,if=talent.beacon_of_virtue.enabled&cooldown.beacon_of_virtue.ready&group.count(cycle.health.pct<85)>=config.bov_trigger_count&var.hp_can_spend&var.wings_or_ac
    - beacon_of_virtue,if=talent.beacon_of_virtue.enabled&cooldown.beacon_of_virtue.ready&group.count(cycle.health.pct<70)>=2&var.hp_can_spend
    - holy_prism,if=var.herald_build&cooldown.holy_prism.ready&var.hp_deficit_ok

  predictive_healing:
    - holy_shock,cycle=casting_target,if=var.holy_shock_ready&cycle.range>0&cycle.range<=40
    - eternal_flame,cycle=casting_target,if=var.hp_can_spend&cycle.range>0&cycle.range<=40
    - word_of_glory,cycle=casting_target,if=var.hp_can_spend&cycle.range>0&cycle.range<=40

  trinkets:
    - trinket_1,if=trinket_1.ready&config.trinket_usage!=0&((config.trinket_usage=1)|(config.trinket_usage=2&var.wings_or_ac)|(config.trinket_usage=3&var.group_heavy_damage))
    - trinket_2,if=trinket_2.ready&config.trinket_usage!=0&((config.trinket_usage=1)|(config.trinket_usage=2&var.wings_or_ac)|(config.trinket_usage=3&var.group_heavy_damage))

  beacon_maintenance:
    - beacon_of_light,cycle=tanks,if=!talent.beacon_of_virtue.enabled&group.count(cycle.buff.beacon_of_light.up)=0&cycle.range>0&cycle.range<=40
    - beacon_of_faith,cycle=dps,if=talent.beacon_of_faith.enabled&group.count(cycle.buff.beacon_of_faith.up)=0&cycle.range>0&cycle.range<=40

  virtue_burst:
    - eternal_flame,cycle=members,if=var.hp_can_spend&cycle.health.pct<85
    - word_of_glory,cycle=members,if=var.hp_can_spend&cycle.health.pct<85
    - holy_shock,cycle=members,if=var.holy_shock_ready&cycle.health.pct<config.shock_heal_hp
    - light_of_dawn,if=var.hp_can_spend&group.count(cycle.health.pct<90)>=2
    - judgment,if=var.judgment_ready&target.valid&var.hp_deficit_ok
    - hammer_of_wrath,if=cooldown.hammer_of_wrath.ready&target.valid&var.hp_deficit_ok

  ac_rotation:
    - light_of_dawn,if=var.hp_capped
    - light_of_dawn,if=var.divine_purpose_up&var.hp_can_spend
    - judgment,if=var.judgment_ready&target.valid&holy_power<5
    - hammer_of_wrath,if=cooldown.hammer_of_wrath.ready&target.valid&holy_power<5
    - crusader_strike,if=cooldown.crusader_strike.ready&target.valid&holy_power<5
    - light_of_dawn,if=var.hp_near_cap
    - light_of_dawn,if=var.hp_can_spend
    - holy_shock,cycle=members,if=var.holy_shock_ready
    - holy_shock.player,if=var.holy_shock_ready&var.player_needs_healing
    - flash_of_light,cycle=members,if=cycle.health.pct<config.fol_heal_hp
    - flash_of_light.player,if=health.pct<config.fol_heal_hp

  tank_healing:
    - eternal_flame,cycle=tanks,if=var.hp_can_spend&var.tank_emergency&cycle.range>0&cycle.range<=40
    - word_of_glory,cycle=tanks,if=var.hp_can_spend&var.tank_emergency&cycle.range>0&cycle.range<=40
    - holy_shock,cycle=tanks,if=var.holy_shock_ready&cycle.health.pct<config.tank_heal_hp&cycle.range>0&cycle.range<=40
    - flash_of_light,cycle=tanks,if=var.infusion_up&var.tank_emergency&cycle.range>0&cycle.range<=40
    - judgment,if=var.judgment_ready&target.valid&var.hp_deficit_ok
    - hammer_of_wrath,if=cooldown.hammer_of_wrath.ready&target.valid&var.hp_deficit_ok
    - flash_of_light,cycle=tanks,if=var.tank_emergency&cycle.range>0&cycle.range<=40

  herald_healing:
    - eternal_flame,cycle=members,if=var.empyrean_legacy_up&var.hp_can_spend&cycle.health.pct<90
    - eternal_flame.player,if=var.empyrean_legacy_up&var.hp_can_spend&var.player_needs_healing
    - light_of_dawn,if=var.empyrean_legacy_up&var.hp_can_spend
    - light_of_dawn,if=var.divine_purpose_up&var.hp_can_spend&group.count(cycle.health.pct<90)>=2
    - eternal_flame,cycle=members,if=var.divine_purpose_up&var.hp_can_spend&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=var.divine_purpose_up&var.hp_can_spend&var.player_needs_healing
    - eternal_flame,cycle=members,if=var.hp_capped&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=var.hp_capped&var.player_needs_healing
    - light_of_dawn,if=var.hp_capped&group.count(cycle.health.pct<90)>=2
    - light_of_dawn,if=var.hp_capped
    - divine_toll,if=var.divine_toll_ready&holy_power<=2
    - holy_shock,cycle=members,if=var.holy_shock_ready&holy_power<5
    - holy_shock.player,if=var.holy_shock_ready&holy_power<5&var.player_needs_healing
    - eternal_flame,cycle=members,if=var.hp_near_cap&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=var.hp_near_cap&var.player_needs_healing
    - light_of_dawn,if=var.hp_near_cap&group.count(cycle.health.pct<90)>=2
    - light_of_dawn,if=var.hp_near_cap
    - judgment,if=var.judgment_ready&var.infusion_up&target.valid&holy_power<5
    - judgment,if=var.judgment_ready&target.valid&holy_power<5
    - hammer_of_wrath,if=cooldown.hammer_of_wrath.ready&target.valid&holy_power<5
    - eternal_flame,cycle=members,if=var.hp_can_spend&!var.hp_pool_for_toll&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=var.hp_can_spend&!var.hp_pool_for_toll&var.player_needs_healing
    - light_of_dawn,if=var.hp_can_spend&!var.hp_pool_for_toll&group.count(cycle.health.pct<90)>=2
    - flash_of_light,cycle=members,if=var.infusion_up&cycle.health.pct<config.emergency_hp
    - flash_of_light.player,if=var.infusion_up&var.player_low_health
    - flash_of_light,cycle=members,if=cycle.health.pct<config.fol_heal_hp
    - flash_of_light.player,if=health.pct<config.fol_heal_hp

  lightsmith_healing:
    - eternal_flame,cycle=members,if=var.empyrean_legacy_up&var.hp_can_spend&cycle.health.pct<90
    - eternal_flame.player,if=var.empyrean_legacy_up&var.hp_can_spend&var.player_needs_healing
    - light_of_dawn,if=var.empyrean_legacy_up&var.hp_can_spend
    - light_of_dawn,if=var.divine_purpose_up&var.hp_can_spend&group.count(cycle.health.pct<90)>=2
    - eternal_flame,cycle=members,if=var.divine_purpose_up&var.hp_can_spend&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=var.divine_purpose_up&var.hp_can_spend&var.player_needs_healing
    - eternal_flame,cycle=members,if=var.hp_capped&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=var.hp_capped&var.player_needs_healing
    - light_of_dawn,if=var.hp_capped&group.count(cycle.health.pct<90)>=2
    - light_of_dawn,if=var.hp_capped
    - divine_toll,if=var.divine_toll_ready&holy_power<=2
    - judgment,if=var.judgment_ready&var.infusion_up&target.valid&holy_power<5
    - judgment,if=var.judgment_ready&target.valid&holy_power<5
    - hammer_of_wrath,if=cooldown.hammer_of_wrath.ready&target.valid&holy_power<5
    - holy_shock,cycle=members,if=var.holy_shock_ready&holy_power<5
    - holy_shock.player,if=var.holy_shock_ready&holy_power<5&var.player_needs_healing
    - eternal_flame,cycle=members,if=var.hp_near_cap&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=var.hp_near_cap&var.player_needs_healing
    - light_of_dawn,if=var.hp_near_cap&group.count(cycle.health.pct<90)>=2
    - light_of_dawn,if=var.hp_near_cap
    - eternal_flame,cycle=members,if=var.hp_can_spend&!var.hp_pool_for_toll&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=var.hp_can_spend&!var.hp_pool_for_toll&var.player_needs_healing
    - light_of_dawn,if=var.hp_can_spend&!var.hp_pool_for_toll&group.count(cycle.health.pct<90)>=2
    - flash_of_light,cycle=members,if=var.infusion_up&cycle.health.pct<config.emergency_hp
    - flash_of_light.player,if=var.infusion_up&var.player_low_health
    - flash_of_light,cycle=members,if=cycle.health.pct<config.fol_heal_hp
    - flash_of_light.player,if=health.pct<config.fol_heal_hp

  member_healing:
    - eternal_flame,cycle=members,if=var.hp_can_spend&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=var.hp_can_spend&var.player_needs_healing
    - word_of_glory,cycle=members,if=var.hp_can_spend&cycle.health.pct<config.member_heal_hp
    - word_of_glory.player,if=var.hp_can_spend&var.player_needs_healing
    - holy_shock,cycle=members,if=var.holy_shock_ready
    - holy_shock.player,if=var.holy_shock_ready&var.player_needs_healing
    - judgment,if=var.judgment_ready&target.valid&var.hp_deficit_ok
    - hammer_of_wrath,if=cooldown.hammer_of_wrath.ready&target.valid&var.hp_deficit_ok
    - light_of_dawn,if=var.hp_can_spend&group.count(cycle.health.pct<85)>=config.lod_min_targets
    - flash_of_light,cycle=members,if=var.infusion_up&cycle.health.pct<config.emergency_hp
    - flash_of_light.player,if=var.infusion_up&var.player_low_health
    - flash_of_light,cycle=members,if=cycle.health.pct<config.fol_heal_hp
    - flash_of_light.player,if=health.pct<config.fol_heal_hp

  mouseover:
    - intercession.mouseover,if=mouseover.dead&health.pct>20
    - lay_on_hands.mouseover,if=mouseover.health.pct<config.lay_on_hands_threshold
    - word_of_glory.mouseover,if=mouseover.health.pct<config.word_of_glory_threshold&var.hp_spendable
    - eternal_flame.mouseover,if=mouseover.health.pct<config.word_of_glory_threshold&var.hp_spendable
    - holy_shock.mouseover,if=mouseover.health.pct<config.holy_shock_healing_threshold&var.holy_shock_ready
    - flash_of_light.mouseover,mouseover.health.pct<config.flash_of_light_threshold

  core_spenders:
    - word_of_glory,cycle=members,if=var.empyrean_legacy_up&cycle.health.pct<90
    - eternal_flame,cycle=members,if=var.empyrean_legacy_up&cycle.health.pct<90
    - light_of_dawn,if=var.sun_sear_up&var.hp_can_spend&group.count(cycle.health.pct<90)>=2
    - word_of_glory,cycle=members,if=var.sun_sear_up&var.hp_can_spend&cycle.health.pct<85
    - eternal_flame,cycle=members,if=var.sun_sear_up&var.hp_can_spend&cycle.health.pct<85
    - light_of_dawn,if=var.suns_avatar_up&var.hp_can_spend&group.count(cycle.health.pct<90)>=2
    - word_of_glory,cycle=members,if=var.suns_avatar_up&var.hp_can_spend&cycle.health.pct<85
    - eternal_flame,cycle=members,if=var.suns_avatar_up&var.hp_can_spend&cycle.health.pct<85
    - light_of_dawn,if=var.hp_capped&group.count(cycle.health.pct<90)>=2
    - word_of_glory,cycle=members,if=var.hp_capped&cycle.health.pct<90
    - eternal_flame,cycle=members,if=var.hp_capped&cycle.health.pct<90
    - shield_of_the_righteous,if=var.hp_capped
    - light_of_dawn,if=!var.bov_active&group.count(cycle.health.pct<85)>=config.lod_min_targets&var.hp_can_spend
    - word_of_glory,cycle=members,if=var.hp_can_spend&cycle.health.pct<config.wog_heal_hp
    - eternal_flame,cycle=members,if=var.hp_can_spend&cycle.health.pct<config.wog_heal_hp
    - shield_of_the_righteous,if=var.hp_can_spend&!var.group_needs_healing

  core_generators:
    - holy_shock,cycle=members,if=var.tyrs_up&cycle.health.pct<90&var.holy_shock_ready
    - holy_light,cycle=members,if=var.divine_favor_up&var.infusion_up&cycle.health.pct<80
    - judgment,if=var.infusion_up&var.hp_deficit_ok
    - hammer_of_wrath,if=var.infusion_up&var.hp_deficit_ok
    - holy_shock,cycle=members,if=cycle.health.pct<config.shock_heal_hp&var.holy_shock_ready
    - holy_shock,if=var.holy_shock_ready&!var.group_needs_healing
    - flash_of_light,cycle=members,if=var.infusion_up&cycle.health.pct<config.fol_heal_hp
    - judgment,if=var.hp_deficit_ok
    - hammer_of_wrath,if=var.hp_deficit_ok
    - holy_light,cycle=members,if=var.infusion_up&cycle.health.pct<config.member_heal_hp
    - consecration,if=!buff.consecration.up

  movement:
    - holy_shock,cycle=members,if=player.moving&var.holy_shock_ready&cycle.health.pct<config.member_heal_hp
    - holy_shock.player,if=player.moving&var.holy_shock_ready&var.player_needs_healing
    - eternal_flame,cycle=members,if=player.moving&var.hp_can_spend&cycle.health.pct<config.member_heal_hp
    - eternal_flame.player,if=player.moving&var.hp_can_spend&var.player_needs_healing
    - word_of_glory,cycle=members,if=player.moving&var.hp_can_spend&cycle.health.pct<config.member_heal_hp
    - word_of_glory.player,if=player.moving&var.hp_can_spend&var.player_needs_healing
    - judgment,if=player.moving&var.judgment_ready&target.valid&var.hp_deficit_ok
    - hammer_of_wrath,if=player.moving&cooldown.hammer_of_wrath.ready&target.valid&var.hp_deficit_ok

  
  
  racial_defensive:
    - stoneform,if=player.dispelable
    - fireblood,if=player.dispelable
    - will_of_the_forsaken,if=player.feared|player.charmed
    - escape_artist,if=player.rooted
    - will_to_survive,if=player.stunned
    - gift_of_the_naaru,if=health.pct<var.racial_emergency_hp
    - stoneform,if=health.pct<var.racial_defensive_hp
    - fireblood,if=health.pct<var.racial_defensive_hp

  racial_offensive:
    - berserking,if=var.wings_or_ac
    - blood_fury,if=var.wings_or_ac
    - ancestral_call,if=var.wings_or_ac
    - fireblood,if=var.wings_or_ac&!player.dispelable

  main:
    - call_action_list,name=spell_queue
    - call_action_list,name=sanity_checks
    - call_action_list,name=pre_pull_setup,if=!player.combat&target.exists&target.boss
    - call_action_list,name=out_of_combat,if=!player.combat
    - return,if=!player.combat
    - call_action_list,name=auto_target,if=player.combat
    - call_action_list,name=emergency_healing,if=var.needs_emergency
    - call_action_list,name=defensive_cooldowns
    - return,if=player.channeling
    - call_action_list,name=interrupts
    - call_action_list,name=dispel
    - call_action_list,name=racial_defensive
    - call_action_list,name=major_cooldowns
    - call_action_list,name=trinkets
    - call_action_list,name=beacon_maintenance
    - call_action_list,name=predictive_healing,if=var.need_preheal
    - call_action_list,name=ac_rotation,if=var.ac_active
    - call_action_list,name=virtue_burst,if=var.bov_active
    - call_action_list,name=tank_healing,if=var.needs_tank_healing
    - call_action_list,name=herald_healing,if=var.herald_build&var.needs_member_healing
    - call_action_list,name=lightsmith_healing,if=var.lightsmith_build&var.needs_member_healing
    - call_action_list,name=member_healing,if=var.needs_member_healing
    - call_action_list,name=mouseover,if=config.mouseover&var.mo_friendly_valid&!player.casting
    - call_action_list,name=movement,if=player.moving
    - call_action_list,name=racial_offensive,if=var.wings_or_ac
    - call_action_list,name=core_spenders
    - call_action_list,name=core_generators
